/*!
 * flipnote.js v1.5.2
 * Real-time, browser-based playback of Flipnote Studio's .ppm animation format
 * 2018 James Daniel
 * github.com/jaames/flipnote.js
 * Flipnote Studio is (c) Nintendo Co., Ltd.
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.flipnote=t():e.flipnote=t()}(this,function(){return function(e){function t(a){if(r[a])return r[a].exports;var i=r[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,a){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var r=e&&e.e?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,r){"use strict";function a(e){return e&&e.e?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),s=r(3),o=a(s),u=r(4),l=a(u),f=function(){function e(t,r,a,n){i(this,e),t.width=r||256,t.height=a||192;var s=t.getContext("webgl",n||{antialias:!1}),u=s.createProgram();this.program=u,this.el=t,this.gl=s,this.refs={shaders:[],textures:[],buffers:[]};var f=this.t(s.VERTEX_SHADER,o.default),h=this.t(s.FRAGMENT_SHADER,l.default);if(s.attachShader(u,f),s.attachShader(u,h),s.linkProgram(u),!s.getProgramParameter(u,s.LINK_STATUS))throw new Error(s.getProgramInfoLog(u));s.useProgram(u);var c=s.createBuffer();this.refs.buffers.push(c),s.bindBuffer(s.ARRAY_BUFFER,c),s.bufferData(s.ARRAY_BUFFER,new Float32Array([1,1,-1,1,-1,-1,1,1,-1,-1,1,-1]),s.STATIC_DRAW),s.enableVertexAttribArray(0),s.vertexAttribPointer(0,2,s.FLOAT,!1,0,0),this.r("u_layer1Bitmap",0,s.TEXTURE0),this.r("u_layer2Bitmap",1,s.TEXTURE1),this.setFilter(),this.setLayerVisibilty(1,!0),this.setLayerVisibilty(2,!0)}return n(e,[{key:"_createShader",value:function(e,t){var r=this.gl,a=r.createShader(e);if(r.shaderSource(a,t),r.compileShader(a),!r.getShaderParameter(a,r.COMPILE_STATUS))throw new Error(r.getShaderInfoLog(a));return this.refs.shaders.push(a),a}},{key:"_createTexture",value:function(e,t,r){var a=this.gl;a.uniform1i(a.getUniformLocation(this.program,e),t),a.activeTexture(r);var i=a.createTexture();a.bindTexture(a.TEXTURE_2D,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),this.refs.textures.push(i)}},{key:"setFilter",value:function(e){var t=this.gl;e="linear"==e?t.LINEAR:t.NEAREST,[t.TEXTURE0,t.TEXTURE1].map(function(r){t.activeTexture(r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e)})}},{key:"setLayerVisibilty",value:function(e,t){this.gl.uniform1i(this.gl.getUniformLocation(this.program,"u_layer"+e+"Visibility"),t)}},{key:"setColor",value:function(e,t){this.gl.uniform4f(this.gl.getUniformLocation(this.program,e),t[0]/255,t[1]/255,t[2]/255,t[3]/255)}},{key:"setPalette",value:function(e){this.setColor("u_paperColor",e[0]),this.setColor("u_layer1Color",e[1]),this.setColor("u_layer2Color",e[2])}},{key:"setBitmaps",value:function(e){var t=this.gl;t.activeTexture(t.TEXTURE0),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,256,192,0,t.ALPHA,t.UNSIGNED_BYTE,e[0]),t.activeTexture(t.TEXTURE1),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,256,192,0,t.ALPHA,t.UNSIGNED_BYTE,e[1])}},{key:"resize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:192;this.el.width=e,this.el.height=t,this.gl.viewport(0,0,e,t)}},{key:"refresh",value:function(){this.gl.drawArrays(this.gl.TRIANGLES,0,6)}},{key:"clear",value:function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)}},{key:"destroy",value:function(){var e=this.refs,t=this.gl;e.shaders.forEach(function(e){t.deleteShader(e)}),e.shaders=[],e.textures.forEach(function(e){t.deleteTexture(e)}),e.textures=[],e.buffers.forEach(function(e){t.deleteBuffer(e)}),e.buffers=[],t.deleteProgram(this.program),t.canvas.width=1,t.canvas.height=1}}]),e}();t.default=f},function(e,t,r){"use strict";var a=r(2),i=function(e){return e&&e.e?e:{default:e}}(a);e.exports={version:"1.5.2",player:i.default}},function(e,t,r){"use strict";function a(e){return e&&e.e?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),s=r(0),o=a(s),u=r(5),l=a(u),f=r(6),h=a(f),c=r(9),d=a(c),p=r(13),m=a(p),_={1:.5,2:1,3:2,4:4,5:6,6:12,7:20,8:30},v=function(){function e(t,r,a){i(this,e),t="string"==typeof t?document.querySelector(t):t,this.canvas=new o.default(t,r,a),this.a=new l.default,this.u=!1,this.f={},this.loop=!1,this.currentFrame=0,this.paused=!0,this.audioTracks=[new m.default("se1"),new m.default("se2"),new m.default("se3"),new m.default("bgm")]}return n(e,[{key:"_load",value:function(e){var t=new h.default(e),r=t.meta;this.ppm=t,this.meta=r,this.frameCount=t.frameCount,this.frameSpeed=t.frameSpeed,this.fileLength=t.fileLength,this.loop=1==r.loop,this.paused=!0,this.u=!0,t.soundMeta.se1.length&&this.audioTracks[0].set(this.ppm.decodeAudio("se1"),1),t.soundMeta.se2.length&&this.audioTracks[1].set(this.ppm.decodeAudio("se2"),1),t.soundMeta.se3.length&&this.audioTracks[2].set(this.ppm.decodeAudio("se3"),1),t.soundMeta.bgm.length&&this.audioTracks[3].set(this.ppm.decodeAudio("bgm"),this.h),this._=this.ppm.decodeSoundFlags(),this.v=null,this.y=!1,this.setFrame(this.ppm.thumbFrameIndex),this.emit("load")}},{key:"open",value:function(e){var t=this;return this.u&&this.close(),(0,d.default)(e).then(function(e){t.g(e)}).catch(function(e){console.error("Error loading Flipnote:",e)})}},{key:"close",value:function(){this.pause(),this.ppm=null,this.u=!1,this.paused=!0,this.loop=null,this.meta=null,this.frameCount=null,this.frameSpeed=null,this.b=0;for(var e=0;e<this.audioTracks.length;e++)this.audioTracks[e].unset();this._=null,this.y=null,this.canvas.clear(),this.a.clear()}},{key:"destroy",value:function(){this.close(),this.canvas.destroy(),this.a.destroy()}},{key:"_playFrameSe",value:function(e){for(var t=this._[e],r=0;r<t.length;r++)t[r]&&this.audioTracks[r].active&&this.audioTracks[r].start()}},{key:"_playBgm",value:function(){this.audioTracks[3].start(this.currentTime)}},{key:"_stopAudio",value:function(){for(var e=0;e<this.audioTracks.length;e++)this.audioTracks[e].stop()}},{key:"play",value:function(){var e=this;if(!this.u||!this.paused)return null;this.paused=!1,this.y&&(this.loop||this.currentFrame!=this.frameCount-1)||(this.b=0),this.k(),this.v=setInterval(function(){e.paused&&clearInterval(e.v),e.currentFrame>=e.frameCount-1?(e.T(),e.loop?(e.firstFrame(),e.k(0),e.emit("playback:loop")):(e.pause(),e.emit("playback:end"))):e.nextFrame()},1e3/this.framerate),this.y=!0,this.emit("playback:start")}},{key:"pause",value:function(){if(!this.u||this.paused)return null;clearInterval(this.v),this.paused=!0,this.T(),this.emit("playback:stop")}},{key:"getFrameImage",value:function(e,t,r,a,i){if(!this.u)return null;var n=this.a;return n.width===t&&n.height===r||n.setSize(t,r),e=Math.max(0,Math.min(e,this.frameCount-1)),n.setPalette(this.ppm.getFramePalette(e)),n.setBitmaps(this.ppm.decodeFrame(e)),n.refresh(),n.toImage(a,i)}},{key:"getThumbImage",value:function(e,t,r,a){return this.getFrameImage(this.ppm.thumbFrameIndex,e,t,r,a)}},{key:"setFrame",value:function(e){if(!this.u||e===this.currentFrame)return null;e=Math.max(0,Math.min(Math.floor(e),this.frameCount-1)),this.b=e,this.U=0,this.canvas.setPalette(this.ppm.getFramePalette(e)),this.canvas.setBitmaps(this.ppm.decodeFrame(e)),this.canvas.refresh(),this.emit("frame:update",this.currentFrame)}},{key:"thumbnailFrame",value:function(){this.currentFrame=this.ppm.thumbFrameIndex}},{key:"nextFrame",value:function(){this.loop&&this.currentFrame>=this.frameCount-1?this.currentFrame=0:this.currentFrame+=1}},{key:"prevFrame",value:function(){this.loop&&this.currentFrame<=0?this.currentFrame=this.frameCount-1:this.currentFrame-=1}},{key:"lastFrame",value:function(){this.currentFrame=this.frameCount-1}},{key:"firstFrame",value:function(){this.currentFrame=0}},{key:"resize",value:function(e,t){this.canvas.resize(e,t)}},{key:"on",value:function(e,t){var r=this.f;(r[e]||(r[e]=[])).push(t)}},{key:"off",value:function(e,t){var r=this.f[e];r&&r.splice(r.indexOf(t),1)}},{key:"emit",value:function(e){for(var t=this.f[e]||[],r=arguments.length,a=Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];for(var n=0;n<t.length;n++)t[n].apply(null,a)}},{key:"currentFrame",get:function(){return this.b},set:function(e){this.setFrame(e)}},{key:"currentTime",get:function(){return this.u?this.currentFrame*(1/this.framerate):null},set:function(e){this.u&&e<this.duration&&e>0&&this.setFrame(Math.round(e/(1/this.framerate)))}},{key:"volume",get:function(){return this.audioTracks[3].audio.volume},set:function(e){for(var t=0;t<this.audioTracks.length;t++)this.audioTracks[t].audio.volume=e}},{key:"muted",get:function(){return this.audioTracks[3].audio.muted},set:function(e){for(var t=0;t<this.audioTracks.length;t++)this.audioTracks[t].audio.muted=e}},{key:"duration",get:function(){return this.u?this.frameCount*(1/this.framerate):null}},{key:"framerate",get:function(){return _[this.frameSpeed]}},{key:"_audiorate",get:function(){return 1/_[this.ppm.bgmSpeed]/(1/_[this.frameSpeed])}}]),e}();t.default=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="\nattribute vec4 a_position;\nvarying vec2 v_texcoord;\nvoid main() {\n  gl_Position = a_position;\n  v_texcoord = a_position.xy * vec2(0.5, -0.5) + 0.5;\n}"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="\nprecision mediump float;\nvarying vec2 v_texcoord;\nuniform vec4 u_paperColor;\nuniform vec4 u_layer1Color;\nuniform vec4 u_layer2Color;\nuniform bool u_layer1Visibility;\nuniform bool u_layer2Visibility;\nuniform sampler2D u_layer1Bitmap;\nuniform sampler2D u_layer2Bitmap;\nvoid main() {\n  float layer1 = u_layer1Visibility ? texture2D(u_layer1Bitmap, v_texcoord).a * 255.0 : 0.0;\n  float layer2 = u_layer2Visibility ? texture2D(u_layer2Bitmap, v_texcoord).a * 255.0 : 0.0;\n  gl_FragColor = mix(mix(u_paperColor, u_layer2Color, layer2), u_layer1Color, layer1);\n}"},function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),o=r(0),u=function(e){return e&&e.e?e:{default:e}}(o),l=function(e){function t(){a(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,document.createElement("canvas"),256,192,{antialias:!0,preserveDrawingBuffer:!0}));return e.setFilter("linear"),e.width=256,e.height=256,e}return n(t,e),s(t,[{key:"setSize",value:function(e,t){this.resize(e,t),this.width=e,this.height=t}},{key:"toImage",value:function(e,t){return this.el.toDataURL(e,t)}}]),t}(u.default);t.default=l},function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),o=r(7),u=function(e){return e&&e.e?e:{default:e}}(o),l=r(8),f=256,h=192,c=[14,14,14,255],d=[255,255,255,255],p=[10,57,255,255],m=[255,42,42,255],_=function(e){function t(e){a(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));r.seek(4),r.F=r.readUint32(),r.w=r.readUint32(),r.frameCount=Math.min(r.readUint16()+1,999),r.seek(18),r.thumbFrameIndex=r.readUint16(),r.seek(1696);var n=r.readUint16();return r.seek(1704),r.P=new Uint32Array(n/4).map(function(e){return 1704+n+r.readUint32()}),r.x(),r.meta=r.A(),r.S=[new Uint8Array(f*h),new Uint8Array(f*h)],r.O=[new Uint8Array(f*h),new Uint8Array(f*h)],r.C=0,r}return n(t,e),s(t,[{key:"_seekToFrame",value:function(e){this.seek(this.P[e])}},{key:"_seekToAudio",value:function(e){this.seek(this.soundMeta[e].offset)}},{key:"_readUtf16",value:function(e){for(var t="",r=!1,a=0;a<e/2;a++){var i=this.readUint16();r||0==i?r=!0:t+=String.fromCharCode(i)}return t}},{key:"_readHex",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=[],a=0;a<e;a++)r.push(this.readUint8().toString(16).padStart(2,"0"));return t&&r.reverse(),r.join("").toUpperCase()}},{key:"_readFilename",value:function(){var e="";e+=this.R(3)+"_";for(var t=0;t<13;t++)e+=String.fromCharCode(this.readUint8());return e+="_",e+=this.readUint16().toString().padStart(3,"0")}},{key:"_readLineEncoding",value:function(){for(var e=new Uint8Array(h),t=0;t<48;t++)for(var r=this.readUint8(),a=0;a<8;a+=2)e[4*t+a/2]=r>>a&3;return e}},{key:"_decodeMeta",value:function(){this.seek(16);var e=this.readUint16(),t=this.readInt16(),r=this.L(22),a=this.L(22),i=this.L(22),n=this.R(8,!0),s=this.R(8,!0),o=this.M(),u=this.M(),l=this.R(8,!0);this.seek(154);var f=new Date(1e3*(this.readUint32()+946684800));return this.seek(1702),{lock:e,loop:this.readUint16()>>1&1,frame_count:this.frameCount,frame_speed:this.frameSpeed,bgm_speed:this.bgmSpeed,thumb_index:t,timestamp:f,spinoff:s!==n||s!==l,root:{username:r,fsid:l},parent:{username:a,fsid:n,filename:o},current:{username:i,fsid:s,filename:u}}}},{key:"_decodeSoundHeader",value:function(){var e=1696+this.F+this.frameCount;e%4!=0&&(e+=4-e%4),this.seek(e);var t=this.readUint32(),r=this.readUint32(),a=this.readUint32(),i=this.readUint32();this.frameSpeed=8-this.readUint8(),this.bgmSpeed=8-this.readUint8(),e+=32,this.soundMeta={bgm:{offset:e,length:t},se1:{offset:e+=t,length:r},se2:{offset:e+=r,length:a},se3:{offset:e+=a,length:i}}}},{key:"_isFrameNew",value:function(e){return this.I(e),this.readUint8()>>7&1}},{key:"_decodePrevFrames",value:function(e){for(var t=0,r=0;!r;)t+=1,r=this.j(e-t);for(t=e-t;t<e;)this.decodeFrame(t,!1),t+=1;this.I(e),this.seek(1,1)}},{key:"getFramePalette",value:function(e){this.I(e);var t=this.readUint8(),r=1&t,a=[null,1==r?c:d,m,p];return[1==r?d:c,a[t>>1&3],a[t>>3&3]]}},{key:"decodeFrame",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.I(e);var r=this.readUint8(),a=r>>7&1,i=r>>5&3,n=0,s=0;t&&!a&&e!==this.C+1&&this.D(e),this.O[0].set(this.S[0]),this.O[1].set(this.S[1]),this.C=e,this.S[0].fill(0),this.S[1].fill(0),i&&(n=this.readInt8(),s=this.readInt8());for(var o=[this.B(),this.B()],u=0;u<2;u++)for(var l=this.S[u],c=0;c<h;c++){var d=c*f,p=o[u][c];switch(p){case 0:break;case 1:case 2:var m=this.readUint32(!1);for(2==p&&l.fill(1,d,d+f);4294967295&m;){if(2147483648&m)for(var _=this.readUint8(),v=0;v<8;v++)l[d+v]=_>>v&1;d+=8,m<<=1}break;case 3:for(;d<(c+1)*f;){for(var _=this.readUint8(),v=0;v<8;v++)l[d+v]=_>>v&1;d+=8}}}if(!a)for(var y,g,b=0;b<h;b++)for(var k=0;k<f;k++)y=k+b*f,g=y-(n+s*f),k-n>f||k-n<0||(this.S[0][y]^=this.O[0][g],this.S[1][y]^=this.O[1][g]);return this.S}},{key:"decodeAudio",value:function(e){var t=this;this.X(e);var r=new Uint8Array(this.soundMeta[e].length).map(function(e){return t.readUint8()});return(0,l.decodeAdpcm)(r)}},{key:"decodeSoundFlags",value:function(){var e=this;return this.seek(1696+this.F),new Array(this.frameCount).fill([]).map(function(t){var r=e.readUint8();return[1&r,r>>1&1,r>>2&1]})}}],[{key:"validateFSID",value:function(e){return/[0159]{1}[0-9A-F]{6}0[0-9A-F]{8}/.test(e)}},{key:"validateFilename",value:function(e){return/[0-9A-F]{6}_[0-9A-F]{13}_[0-9]{3}/.test(e)}}]),t}(u.default);t.default=_},function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),n=function(){function e(t){a(this,e),this.H=new DataView(t),this.N=0}return i(e,[{key:"seek",value:function(e,t){switch(t){case 2:this.N=this.H.byteLength+e;break;case 1:this.N+=e;break;case 0:default:this.N=e}}},{key:"readUint8",value:function(){var e=this.H.getUint8(this.N);return this.N+=1,e}},{key:"readInt8",value:function(){var e=this.H.getInt8(this.N);return this.N+=1,e}},{key:"readUint16",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.H.getUint16(this.N,e);return this.N+=2,t}},{key:"readInt16",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.H.getInt16(this.N,e);return this.N+=2,t}},{key:"readUint32",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.H.getUint32(this.N,e);return this.N+=4,t}},{key:"readInt32",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.H.getInt32(this.N,e);return this.N+=4,t}},{key:"fileLength",get:function(){return this.H.byteLength}}]),e}();t.default=n},function(e,t,r){"use strict";function a(e){u=0,l=0;for(var t=new Int16Array(2*e.length),r=0,a=0;a<e.length;a++){var n=e[a];t[r]=i(15&n),t[r+1]=i(n>>4&15),r+=2}return t}function i(e){var t=u,r=l,a=o[r],i=a>>3;return 4&e&&(i+=a),2&e&&(i+=a>>1),1&e&&(i+=a>>2),t+=8&e?-i:i,r+=s[e],r=n(r,0,88),t=n(t,-32767,32767),u=t,l=r,t}function n(e,t,r){return e<=t?t:e>=r?r:e}Object.defineProperty(t,"__esModule",{value:!0}),t.decodeAdpcm=a;var s=[-1,-1,-1,-1,2,4,6,8,-1,-1,-1,-1,2,4,6,8],o=[7,8,9,10,11,12,13,14,16,17,19,21,23,25,28,31,34,37,41,45,50,55,60,66,73,80,88,97,107,118,130,143,157,173,190,209,230,253,279,307,337,371,408,449,494,544,598,658,724,796,876,963,1060,1166,1282,1411,1552,1707,1878,2066,2272,2499,2749,3024,3327,3660,4026,4428,4871,5358,5894,6484,7132,7845,8630,9493,10442,11487,12635,13899,15289,16818,18500,20350,22385,24623,27086,29794,32767],u=0,l=0},function(e,t,r){"use strict";function a(e){return e&&e.e?e:{default:e}}function i(e){return new Promise(function(t,r){for(var a=0;a<h.length;a++){var i=h[a];if(i.matches(e)){i.load(e,t,r);break}}})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var n=r(10),s=a(n),o=r(11),u=a(o),l=r(12),f=a(l),h=[s.default,u.default,f.default]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={matches:function(e){return"string"==typeof e},load:function(e,t,r){var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.onreadystatechange=function(e){4===a.readyState&&(a.status>=200&&a.status<300?t(a.response):r({type:"httpError",status:a.status,statusText:a.statusText}))},a.send(null)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={matches:function(e){return e instanceof File},load:function(e,t,r){var a=new FileReader;a.onload=function(e){t(e.target.result)},a.onerror=function(e){r({type:"fileReadError"})},a.readAsArrayBuffer(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={matches:function(e){return e instanceof ArrayBuffer},load:function(e,t,r){t(e)}}},function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),n=function(){function e(t){a(this,e),this.id=t,this.channelCount=1,this.bitsPerSample=16,this.sampleRate=8192,this.playbackRate=1,this.audio=document.createElement("audio"),this.audio.preload=!0,this.active=!1}return i(e,[{key:"set",value:function(e,t){var r=new DataView(new ArrayBuffer(44));r.setUint32(0,1179011410,!0),r.setUint32(4,r.byteLength+e.byteLength,!0),r.setUint32(8,1163280727,!0),r.setUint32(12,544501094,!0),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,this.channelCount,!0),r.setUint32(24,this.sampleRate*t,!0),r.setUint32(28,this.sampleRate*t*this.bitsPerSample*this.channelCount/8,!0),r.setUint16(32,this.bitsPerSample*this.channelCount/8,!0),r.setUint16(34,this.bitsPerSample,!0),r.setUint32(36,1635017060,!0),r.setUint32(40,e.byteLength,!0),this.url=window.URL.createObjectURL(new Blob([r.buffer,e.buffer],{type:"audio/wav"})),this.audio.src=this.url,this.active=!0,this.playbackRate=t,this.length=e.length}},{key:"unset",value:function(){this.active&&(window.URL.revokeObjectURL(this.url),this.audio.src="",this.audio.load(),this.active=!1,this.playbackRate=1,this.length=null)}},{key:"start",value:function(e){this.active&&(this.audio.currentTime=e||0,this.audio.play())}},{key:"stop",value:function(){this.active&&this.audio.pause()}},{key:"duration",get:function(){return this.audio.duration}}]),e}();t.default=n}])});