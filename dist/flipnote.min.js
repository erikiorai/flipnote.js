/*!
 * flipnote.js v2.6.2
 * Browser-based playback of .ppm and .kwz animations from Flipnote Studio and Flipnote Studio 3D
 * 2018 James Daniel
 * github.com/jaames/flipnote.js
 * Flipnote Studio is (c) Nintendo Co., Ltd.
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.flipnote=t():e.flipnote=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(i,a,function(t){return e[t]}.bind(null,a));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=8)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.buffer=t,this._data=new DataView(t),this._offset=0}return i(e,[{key:"seek",value:function(e,t){switch(t){case 2:this._offset=this._data.byteLength+e;break;case 1:this._offset+=e;break;case 0:default:this._offset=e}}},{key:"readUint8",value:function(){var e=this._data.getUint8(this._offset);return this._offset+=1,e}},{key:"writeUint8",value:function(e){this._data.setUint8(this._offset,e),this._offset+=1}},{key:"readInt8",value:function(){var e=this._data.getInt8(this._offset);return this._offset+=1,e}},{key:"writeInt8",value:function(e){this._data.setInt8(this._offset,e),this._offset+=1}},{key:"readUint16",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this._data.getUint16(this._offset,e);return this._offset+=2,t}},{key:"writeUint16",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._data.setUint16(this._offset,e,t),this._offset+=2}},{key:"readInt16",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this._data.getInt16(this._offset,e);return this._offset+=2,t}},{key:"writeInt16",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._data.setInt16(this._offset,e,t),this._offset+=2}},{key:"readUint32",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this._data.getUint32(this._offset,e);return this._offset+=4,t}},{key:"writeUint32",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._data.setUint32(this._offset,e,t),this._offset+=4}},{key:"readInt32",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this._data.getInt32(this._offset,e);return this._offset+=4,t}},{key:"writeInt32",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._data.setInt32(this._offset,e,t),this._offset+=4}},{key:"readBytes",value:function(e){var t=new Uint8Array(this._data.buffer,this._offset,e);return this._offset+=t.byteLength,t}},{key:"readHex",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.readBytes(e),i=[],a=0;a<r.length;a++)i.push(r[a].toString(16).padStart(2,"0"));return t&&i.reverse(),i.join("").toUpperCase()}},{key:"readUtf8",value:function(e){for(var t=this.readBytes(e),r="",i=0;i<t.length;i++){var a=t[i];if(0==a)break;r+=String.fromCharCode(a)}return r}},{key:"writeUtf8",value:function(e){for(var t=0;t<e.length;t++){var r=e.charCodeAt(t);this.writeUint8(r)}}},{key:"readUtf16",value:function(e){var t=new Uint16Array(this._data.buffer,this._offset,e);this._offset+=t.byteLength;for(var r="",i=0;i<t.length;i++){var a=t[i];if(0==a)break;r+=String.fromCharCode(a)}return r}},{key:"byteLength",get:function(){return this._data.byteLength}}]),e}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BitmapEncoder=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();t.roundToNearest=n;var a=function(e){return e&&e.__esModule?e:{default:e}}(r(0));function n(e,t){return Math.ceil(e/t)*t}t.BitmapEncoder=function(){function e(t,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.width=t,this.height=r,this.vWidth=n(t,4),this.vHeight=n(r,4),this.bpp=i,this.fileHeader=new a.default(new ArrayBuffer(14)),this.fileHeader.writeUtf8("BM"),this.dibHeader=new a.default(new ArrayBuffer(108)),this.dibHeader.writeUint32(108),this.dibHeader.writeInt32(t),this.dibHeader.writeInt32(r),this.dibHeader.writeUint16(1),this.dibHeader.writeUint16(i),this.dibHeader.writeUint32(3),this.dibHeader.writeUint32(this.vWidth*this.height/(i/8)),this.dibHeader.writeUint32(3780),this.dibHeader.writeUint32(3780),this.dibHeader.writeUint32(0),this.dibHeader.writeUint32(0),this.dibHeader.writeUint32(16711680),this.dibHeader.writeUint32(65280),this.dibHeader.writeUint32(255),this.dibHeader.writeUint32(4278190080),this.dibHeader.writeUtf8("Win ")}return i(e,[{key:"setFilelength",value:function(e){this.fileHeader.seek(2),this.fileHeader.writeUint32(e)}},{key:"setPixelOffset",value:function(e){this.fileHeader.seek(10),this.fileHeader.writeUint32(e)}},{key:"setCompression",value:function(e){this.dibHeader.seek(16),this.dibHeader.writeUint32(e)}},{key:"setPaletteCount",value:function(e){this.dibHeader.seek(32),this.dibHeader.writeUint32(e)}},{key:"setPalette",value:function(e){for(var t=new Uint32Array(Math.pow(2,this.bpp)),r=0;r<e.length;r++){var i=e[r%e.length];t[r]=4278190080|i[0]<<16|i[1]<<8|i[2]}this.setPaletteCount(t.length),this.setCompression(0),this.palette=t}},{key:"setPixels",value:function(e){var t=void 0,r=this.vWidth*this.height;switch(this.bpp){case 8:t=new Uint8Array(r);break;case 32:t=new Uint32Array(r)}for(var i=this.width,a=0;a<this.height;a++){var n=i*this.height-(a+1)*i,s=a*this.width;t.set(e.slice(n,n+this.width),s)}this.pixels=t}},{key:"getBlob",value:function(){var e=[this.fileHeader.buffer,this.dibHeader.buffer],t=this.fileHeader.byteLength+this.dibHeader.byteLength;switch(this.bpp){case 1:case 4:case 8:this.setFilelength(t+this.pixels.byteLength+this.palette.byteLength),this.setPixelOffset(t+this.palette.byteLength),e=e.concat([this.palette.buffer,this.pixels.buffer]);break;case 16:case 32:this.setFilelength(t+this.pixels.byteLength),this.setPixelOffset(t),e=e.concat([this.pixels.buffer])}return new Blob(e,{type:"image/bitmap"})}},{key:"getUrl",value:function(){return window.URL.createObjectURL(this.getBlob())}},{key:"getImage",value:function(){var e=new Image(this.width,this.height);return e.src=this.getUrl(),e}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=s(r(11)),n=s(r(12));function s(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:640,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:480,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{antialias:!1,alpha:!1};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.width=t.width=r,this.height=t.height=i;var o=t.getContext("webgl",s),u=o.createProgram();this.program=u,this.el=t,this.gl=o,this.refs={shaders:[],textures:[],buffers:[]};var h=this._createShader(o.VERTEX_SHADER,a.default),f=this._createShader(o.FRAGMENT_SHADER,n.default);if(o.attachShader(u,h),o.attachShader(u,f),o.linkProgram(u),!o.getProgramParameter(u,o.LINK_STATUS)){var l=o.getProgramInfoLog(u);throw o.deleteProgram(u),new Error(l)}o.useProgram(u);var d=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,d),o.bufferData(o.ARRAY_BUFFER,new Float32Array([1,1,-1,1,-1,-1,1,1,-1,-1,1,-1]),o.STATIC_DRAW),o.enableVertexAttribArray(0),o.vertexAttribPointer(0,2,o.FLOAT,!1,0,0),this.refs.buffers.push(d),o.activeTexture(o.TEXTURE0);var c=o.createTexture();o.bindTexture(o.TEXTURE_2D,c),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),this.uniforms={};for(var v=o.getProgramParameter(u,o.ACTIVE_UNIFORMS),y=0;y<v;y++){var m=o.getActiveUniform(u,y).name;this.uniforms[m]=o.getUniformLocation(u,m)}o.uniform1i(this.uniforms.u_bitmap,0),this.setFilter("linear"),this.setMode("PPM"),this.refs.textures.push(c),o.enable(o.BLEND),o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA)}return i(e,[{key:"_createShader",value:function(e,t){var r=this.gl,i=r.createShader(e);if(r.shaderSource(i,t),r.compileShader(i),!r.getShaderParameter(i,r.COMPILE_STATUS)){var a=r.getShaderInfoLog(i);throw r.deleteShader(i),new Error(a)}return this.refs.shaders.push(i),i}},{key:"toImage",value:function(e,t){return this.el.toDataURL(e,t)}},{key:"setFilter",value:function(e){var t=this.gl;e="linear"==e?t.LINEAR:t.NEAREST,t.uniform1i(this.uniforms.u_isSmooth,"linear"==e?0:1),t.activeTexture(t.TEXTURE0),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e)}},{key:"setMode",value:function(e){var t=this.gl;"PPM"===e?this.textureType=t.ALPHA:"KWZ"===e&&(this.textureType=t.LUMINANCE_ALPHA)}},{key:"setColor",value:function(e,t){this.gl.uniform4f(this.uniforms[e],t[0]/255,t[1]/255,t[2]/255,1)}},{key:"setPaperColor",value:function(e){this.gl.clearColor(e[0]/255,e[1]/255,e[2]/255,1)}},{key:"drawLayer",value:function(e,t,r,i,a,n){var s=this.gl;s.activeTexture(s.TEXTURE0),s.texImage2D(s.TEXTURE_2D,0,this.textureType,t,r,0,this.textureType,s.UNSIGNED_BYTE,e),this.setColor("u_color1",i),this.setColor("u_color2",a),s.drawArrays(s.TRIANGLES,0,6)}},{key:"resize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:640,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:480;this.el.width=e,this.el.height=t,this.width=e,this.height=t,this.gl.viewport(0,0,e,t)}},{key:"clear",value:function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)}},{key:"destroy",value:function(){var e=this.refs,t=this.gl;e.shaders.forEach(function(e){t.deleteShader(e)}),e.shaders=[],e.textures.forEach(function(e){t.deleteTexture(e)}),e.textures=[],e.buffers.forEach(function(e){t.deleteBuffer(e)}),e.buffers=[],t.deleteProgram(this.program),t.canvas.width=1,t.canvas.height=1}}]),e}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=new DataView(e,0,4).getUint32(0);if(1346458177==t)return new i.default(e);if(1262897152==(4294967040&t))return new a.default(e);return null};var i=n(r(4)),a=n(r(6));function n(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),n=r(5),s=r(1);var o={1:.5,2:1,3:2,4:4,5:6,6:12,7:20,8:30},u=256,h=192,f={WHITE:[255,255,255],BLACK:[14,14,14],RED:[255,42,42],BLUE:[10,57,255]},l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.type="PPM",r._decodeHeader(),r._decodeAnimationHeader(),r._decodeSoundHeader(),r._decodeMeta(),r.sampleRate=8192,r.palette=f,r._layers=[new Uint8Array(u*h),new Uint8Array(u*h)],r._prevLayers=[new Uint8Array(u*h),new Uint8Array(u*h)],r._prevDecodedFrame=null,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"readFilename",value:function(){return[this.readHex(3),this.readUtf8(13),this.readUint16().toString().padStart(3,"0")].join("_")}},{key:"readLineEncoding",value:function(){for(var e=new Uint8Array(h),t=0;t<48;t++)for(var r=this.readUint8(),i=0;i<8;i+=2)e[4*t+i/2]=r>>i&3;return e}},{key:"_decodeHeader",value:function(){this.seek(0);this.readUint32();this._frameDataLength=this.readUint32(),this._soundDataLength=this.readUint32(),this.frameCount=this.readUint16()+1,this.version=this.readUint16()}},{key:"_decodeMeta",value:function(){this.seek(16);var e=this.readUint16(),t=this.readInt16(),r=this.readUtf16(11),i=this.readUtf16(11),a=this.readUtf16(11),n=this.readHex(8,!0),s=this.readHex(8,!0),o=this.readFilename(),u=this.readFilename(),h=this.readHex(8,!0);this.seek(154);var f=new Date(1e3*(this.readUint32()+946684800));this.seek(1702);var l=this.readUint16();this.thumbFrameIndex=t,this.meta={lock:e,loop:l>>1&1,frame_count:this.frameCount,frame_speed:this.frameSpeed,bgm_speed:this.bgmSpeed,thumb_index:t,timestamp:f,spinoff:s!==n||s!==h,root:{filename:null,username:r,fsid:h},parent:{username:i,fsid:n,filename:o},current:{username:a,fsid:s,filename:u}}}},{key:"_decodeAnimationHeader",value:function(){var e=this;this.seek(1696);var t=this.readUint16();this.seek(1704),this._frameOffsets=new Uint32Array(t/4).map(function(r){return 1704+t+e.readUint32()})}},{key:"_decodeSoundHeader",value:function(){var e=1696+this._frameDataLength+this.frameCount;e%2!=0&&(e+=4-e%4),this.seek(e);var t=this.readUint32(),r=this.readUint32(),i=this.readUint32(),a=this.readUint32();this.frameSpeed=8-this.readUint8(),this.bgmSpeed=8-this.readUint8(),e+=32,this.framerate=o[this.frameSpeed],this.bgmrate=o[this.bgmSpeed],this.soundMeta={bgm:{offset:e,length:t},se1:{offset:e+=t,length:r},se2:{offset:e+=r,length:i},se3:{offset:e+=i,length:a}}}},{key:"isNewFrame",value:function(e){return this.seek(this._frameOffsets[e]),this.readUint8()>>7&1}},{key:"getFramePalette",value:function(e){this.seek(this._frameOffsets[e]);var t=this.palette,r=this.readUint8(),i=1&r,a=[t.BLACK,1==i?t.BLACK:t.WHITE,t.RED,t.BLUE];return[1==i?t.WHITE:t.BLACK,a[r>>1&3],a[r>>3&3]]}},{key:"decodeFrame",value:function(e){0===e||this._prevDecodedFrame===e-1||this.isNewFrame(e)||this.decodeFrame(e-1),this.seek(this._frameOffsets[e]);var t=this.readUint8(),r=t>>7&1,i=t>>5&3,a=0,n=0;this._prevLayers[0].set(this._layers[0]),this._prevLayers[1].set(this._layers[1]),this._prevDecodedFrame=e,this._layers[0].fill(0),this._layers[1].fill(0),i&&(a=this.readInt8(),n=this.readInt8());for(var s=[this.readLineEncoding(),this.readLineEncoding()],o=0;o<2;o++)for(var f=this._layers[o],l=0;l<h;l++){var d=l*u,c=s[o][l];switch(c){case 0:break;case 1:case 2:var v=this.readUint32(!1);for(2==c&&f.fill(255,d,d+u);4294967295&v;){if(2147483648&v)for(var y=this.readUint8(),m=0;m<8;m++)f[d+m]=y>>m&1?255:0;d+=8,v<<=1}break;case 3:for(;d<(l+1)*u;){for(y=this.readUint8(),m=0;m<8;m++)f[d+m]=y>>m&1?255:0;d+=8}}}if(!r)for(var p,_,g=0;g<h;g++)if(!(g-n<0)){if(g-n>=h)break;for(var b=0;b<u;b++)if(!(b-a<0)){if(b-a>=u)break;_=(p=b+g*u)-(a+n*u),this._layers[0][p]^=this._prevLayers[0][_],this._layers[1][p]^=this._prevLayers[1][_]}}return this._layers}},{key:"getLayerPixels",value:function(e,t){this._prevDecodedFrame!==e&&this.decodeFrame(e);for(var r=this._layers[t],i=new Uint8Array(49152),a=t+1,n=0;n<i.length;n++)0!==r[n]&&(i[n]=a);return i}},{key:"getFramePixels",value:function(e){for(var t=this.decodeFrame(e),r=new Uint8Array(49152),i=0;i<r.length;i++){var a=t[0][i];t[1][i]&&(r[i]=2),a&&(r[i]=1)}return r}},{key:"getFrameBitmap",value:function(e){var t=new s.BitmapEncoder(256,192,8);return t.setPixels(this.getFramePixels(e)),t.setPalette(this.getFramePalette(e)),t}},{key:"hasAudioTrack",value:function(e){var t=["bgm","se1","se2","se3"][e];return this.soundMeta[t].length>0}},{key:"decodeAudio",value:function(e){for(var t,r,i,a=this.soundMeta[e],s=new Uint8Array(this.buffer,a.offset,a.length),o=new Int16Array(2*s.length),u=0,h=0,f=0,l=0;l<s.length;l++)for(var d=s[l],c=0;c<8;)t=d>>c&15,r=h+n.ADPCM_SAMPLE_TABLE_4[t+16*f],i=f+n.ADPCM_INDEX_TABLE_4[t],i=Math.max(0,Math.min(i,79)),r=Math.max(-32767,Math.min(r,32767)),o[u]=r,u+=1,f=i,h=r,c+=4;return o}},{key:"decodeSoundFlags",value:function(){var e=this;return this.seek(1696+this._frameDataLength),new Array(this.frameCount).fill([]).map(function(t){var r=e.readUint8();return[1&r,r>>1&1,r>>2&1]})}}],[{key:"validateFSID",value:function(e){return/[0159]{1}[0-9A-F]{6}0[0-9A-F]{8}/.test(e)}},{key:"validateFilename",value:function(e){return/[0-9A-F]{6}_[0-9A-F]{13}_[0-9]{3}/.test(e)}}]),t}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ADPCM_INDEX_TABLE_2=new Int8Array([-1,2,-1,2]),t.ADPCM_INDEX_TABLE_4=new Int8Array([-1,-1,-1,-1,2,4,6,8,-1,-1,-1,-1,2,4,6,8]);for(var i=t.ADPCM_STEP_TABLE=new Int16Array([7,8,9,10,11,12,13,14,16,17,19,21,23,25,28,31,34,37,41,45,50,55,60,66,73,80,88,97,107,118,130,143,157,173,190,209,230,253,279,307,337,371,408,449,494,544,598,658,724,796,876,963,1060,1166,1282,1411,1552,1707,1878,2066,2272,2499,2749,3024,3327,3660,4026,4428,4871,5358,5894,6484,7132,7845,8630,9493,10442,11487,12635,13899,15289,16818,18500,20350,22385,24623,27086,29794,32767,0]),a=t.ADPCM_SAMPLE_TABLE_2=new Int16Array(360),n=0;n<4;n++)for(var s=0;s<90;s++){var o=i[s],u=o>>3;1&n&&(u+=o),2&n&&(u=-u),a[n+4*s]=u}for(var h=t.ADPCM_SAMPLE_TABLE_4=new Int16Array(1440),f=0;f<16;f++)for(var l=0;l<90;l++){var d=i[l],c=d>>3;4&f&&(c+=d),2&f&&(c+=d>>1),1&f&&(c+=d>>2),8&f&&(c=-c),h[f+16*l]=c}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),n=r(5),s=r(1);for(var o=[.2,.5,1,2,4,6,8,12,20,24,30],u={WHITE:[255,255,255],BLACK:[16,16,16],RED:[255,16,16],YELLOW:[255,231,0],GREEN:[0,134,49],BLUE:[0,56,206],NONE:[255,255,255]},h=["WHITE","BLACK","RED","YELLOW","GREEN","BLUE","NONE"],f=new Uint16Array([0,3280,6560,729,2187,81,243,9,27,1,3,1458,4374,162,486,18,54,2,6,2916,2268,324,252,36,28,4,820,2460,1640,4920,4100,5740]),l=new Uint16Array([0,3280,6560,3,729,2187,81,243,9,27,1,6,1458,4374,162,486,18,54,2,732,2916,2268,324,252,36,28,2460,820,4920,1640,5740,4100]),d=new Uint16Array(6561),c=[0,3,7,1,4,8,2,5,6],v=0,y=0;y<9;y++)for(var m=0;m<9;m++)for(var p=0;p<9;p++)for(var _=0;_<9;_++)d[v]=9*(9*(9*c[y]+c[m])+c[p])+c[_],v++;for(var g=new Uint16Array(52488),b=(c=[0,65280,255],0),k=0;k<3;k++)for(var w=0;w<3;w++)for(var U=0;U<3;U++)for(var A=0;A<3;A++)for(var E=0;E<3;E++)for(var P=0;P<3;P++)for(var F=0;F<3;F++)for(var T=0;T<3;T++)g.set([c[w],c[k],c[A],c[U],c[P],c[E],c[T],c[F]],b),b+=8;var L=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.type="KWZ",r._layers=[new Uint16Array(76800),new Uint16Array(76800),new Uint16Array(76800)],r._bitIndex=0,r._bitValue=0,r.load(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"load",value:function(){this.seek(0),this.sections={};for(var e=this.byteLength-256,t=0,r=0;t<e&&r<6;){this.seek(t);var i=this.readUtf8(4).substring(0,3),a=this.readUint32();this.sections[i]={offset:t,length:a},t+=a+8,r+=1}this._decodeMeta(),this._decodeFrameMeta(),this._decodeSoundHeader(),this.sampleRate=16364,this.palette=u,this._prevDecodedFrame=null}},{key:"readBits",value:function(e){if(this._bitIndex+e>16){var t=this.readUint16();this._bitValue|=t<<16-this._bitIndex,this._bitIndex-=16}var r=(1<<e)-1,i=this._bitValue&r;return this._bitValue>>=e,this._bitIndex+=e,i}},{key:"_decodeMeta",value:function(){this.seek(this.sections.KFH.offset+12);var e=new Date(1e3*(this.readUint32()+946684800)),t=new Date(1e3*(this.readUint32()+946684800)),r=(this.readUint32(),this.readHex(10)),i=this.readHex(10),a=this.readHex(10),n=this.readUtf16(11),s=this.readUtf16(11),u=this.readUtf16(11),h=this.readUtf8(28),f=this.readUtf8(28),l=this.readUtf8(28),d=this.readUint16(),c=this.readUint16(),v=this.readUint16(),y=this.readUint8();this.readUint8();this.frameCount=d,this.thumbFrameIndex=c,this.frameSpeed=y,this.framerate=o[y],this.meta={lock:1&v,loop:v>>1&1,frame_count:d,frame_speed:y,thumb_index:c,timestamp:t,creation_timestamp:e,root:{username:n,fsid:r,filename:h},parent:{username:s,fsid:i,filename:f},current:{username:u,fsid:a,filename:l}}}},{key:"_decodeFrameMeta",value:function(){this.frameMeta=[],this.frameOffsets=[],this.seek(this.sections.KMI.offset+8),b=this.sections.KMC.offset+12;for(var e=0;e<this.frameCount;e++){var t={flags:this.readUint32(),layerSize:[this.readUint16(),this.readUint16(),this.readUint16()],frameAuthor:this.readHex(10),layerDepth:[this.readUint8(),this.readUint8(),this.readUint8()],soundFlags:this.readUint8(),cameraFlag:this.readUint32()};this.frameMeta.push(t),this.frameOffsets.push(b),b+=t.layerSize[0]+t.layerSize[1]+t.layerSize[2]}}},{key:"_decodeSoundHeader",value:function(){var e=this.sections.KSN.offset+8;this.seek(e);var t=this.readUint32();this.bgmSpeed=t,this.bgmrate=o[t];var r=new Uint32Array(this.buffer,e+4,20);this.soundMeta={bgm:{offset:e+=28,length:r[0]},se1:{offset:e+=r[0],length:r[1]},se2:{offset:e+=r[1],length:r[2]},se3:{offset:e+=r[2],length:r[3]},se4:{offset:e+=r[3],length:r[4]}}}},{key:"getDiffingFlag",value:function(e){return 7&~(this.frameMeta[e].flags>>4)}},{key:"getLayerDepths",value:function(e){return this.frameMeta[e].layerDepth}},{key:"getLayerOrder",value:function(e){var t=this.getLayerDepths(e);return[2,1,0].sort(function(e,r){return t[r]-t[e]})}},{key:"decodeFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r&&(t&=this.getDiffingFlag(e+1)),0!==e&&this._prevDecodedFrame!==e-1&&t&&this.decodeFrame(e-1,t=t,r=!0);for(var i=this.frameMeta[e],a=this.frameOffsets[e],n=0;n<3;n++){this.seek(a);var s=i.layerSize[n];if(a+=s,38!==s&&!(t>>n&!1)){this._bitIndex=16,this._bitValue=0;for(var o=0,u=0;u<240;u+=128)for(var h=0;h<320;h+=128)for(var c=0;c<128;c+=8){var v=u+c;if(v>=240)break;for(var y=0;y<128;y+=8){var m=h+y;if(m>=320)break;if(o)o-=1;else{var p=320*v+m,_=this._layers[n],b=this.readBits(3);if(0==b){var k=f[this.readBits(5)],w=g.subarray(8*k,8*k+8);_.set(w,p),_.set(w,p+320),_.set(w,p+640),_.set(w,p+960),_.set(w,p+1280),_.set(w,p+1600),_.set(w,p+1920),_.set(w,p+2240)}else if(1==b){var U=this.readBits(13),A=g.subarray(8*U,8*U+8);_.set(A,p),_.set(A,p+320),_.set(A,p+640),_.set(A,p+960),_.set(A,p+1280),_.set(A,p+1600),_.set(A,p+1920),_.set(A,p+2240)}else if(2==b){var E=this.readBits(5),P=f[E],F=l[E],T=g.subarray(8*P,8*P+8),L=g.subarray(8*F,8*F+8);_.set(T,p),_.set(L,p+320),_.set(T,p+640),_.set(L,p+960),_.set(T,p+1280),_.set(L,p+1600),_.set(T,p+1920),_.set(L,p+2240)}else if(3==b){var M=this.readBits(13),x=d[M],S=g.subarray(8*M,8*M+8),C=g.subarray(8*x,8*x+8);_.set(S,p),_.set(C,p+320),_.set(S,p+640),_.set(C,p+960),_.set(S,p+1280),_.set(C,p+1600),_.set(S,p+1920),_.set(C,p+2240)}else if(4==b)for(var O=this.readBits(8),I=0;I<8;I++){var B=0;B=O&1<<I?f[this.readBits(5)]:this.readBits(13);var R=g.subarray(8*B,8*B+8);_.set(R,p+320*I)}else{if(5==b){o=this.readBits(5);continue}if(7==b){var D=this.readBits(2),H=0,j=0;this.readBits(1)?(H=f[this.readBits(5)],j=f[this.readBits(5)],D=(D+1)%4):(H=this.readBits(13),j=this.readBits(13));var N=g.subarray(8*H,8*H+8),X=g.subarray(8*j,8*j+8);0==D?(_.set(N,p),_.set(X,p+320),_.set(N,p+640),_.set(X,p+960),_.set(N,p+1280),_.set(X,p+1600),_.set(N,p+1920),_.set(X,p+2240)):1==D?(_.set(N,p),_.set(N,p+320),_.set(X,p+640),_.set(N,p+960),_.set(N,p+1280),_.set(X,p+1600),_.set(N,p+1920),_.set(N,p+2240)):2==D?(_.set(N,p),_.set(X,p+320),_.set(N,p+640),_.set(N,p+960),_.set(X,p+1280),_.set(N,p+1600),_.set(N,p+1920),_.set(X,p+2240)):3==D&&(_.set(N,p),_.set(X,p+320),_.set(X,p+640),_.set(N,p+960),_.set(X,p+1280),_.set(X,p+1600),_.set(N,p+1920),_.set(X,p+2240))}}}}}}}return this._prevDecodedFrame=e,[new Uint8Array(this._layers[0].buffer),new Uint8Array(this._layers[1].buffer),new Uint8Array(this._layers[2].buffer)]}},{key:"getFramePalette",value:function(e){var t=this.frameMeta[e].flags;return[this.palette[h[15&t]],this.palette[h[t>>8&15]],this.palette[h[t>>12&15]],this.palette[h[t>>16&15]],this.palette[h[t>>20&15]],this.palette[h[t>>24&15]],this.palette[h[t>>28&15]]]}},{key:"getLayerPixels",value:function(e,t){this._prevDecodedFrame!==e&&this.decodeFrame(e);for(var r=this._layers[t],i=new Uint8Array(76800),a=2*t+1,n=0;n<r.length;n++){var s=r[n];65280&s?i[n]=a:255&s&&(i[n]=a+1)}return i}},{key:"getFramePixels",value:function(e){var t=this,r=new Uint8Array(76800);return this.getLayerOrder(e).forEach(function(i){for(var a=t.getLayerPixels(e,i),n=0;n<a.length;n++){var s=a[n];0!==s&&(r[n]=s)}}),r}},{key:"getFrameBitmap",value:function(e){var t=new s.BitmapEncoder(320,240,8);return t.setPixels(this.getFramePixels(e)),t.setPalette(this.getFramePalette(e)),t}},{key:"decodeSoundFlags",value:function(){return this.frameMeta.map(function(e){var t=e.soundFlags;return[1&t,t>>1&1,t>>2&1,t>>3&1]})}},{key:"hasAudioTrack",value:function(e){var t=["bgm","se1","se2","se3","se4"][e];return this.soundMeta[t].length>0}},{key:"decodeAudio",value:function(e){for(var t,r,i,a=this.soundMeta[e],s=new Int16Array(981840),o=0,u=new Uint8Array(this.buffer,a.offset,a.length),h=0,f=40,l=0;l<u.length;l++)for(var d=u[l],c=0;c<8;)f<18||6==c?(t=d>>c&3,r=h+n.ADPCM_SAMPLE_TABLE_2[t+4*f],i=f+n.ADPCM_INDEX_TABLE_2[t],c+=2):(t=d>>c&15,r=h+n.ADPCM_SAMPLE_TABLE_4[t+16*f],i=f+n.ADPCM_INDEX_TABLE_4[t],c+=4),i=Math.max(0,Math.min(i,79)),r=Math.max(-2048,Math.min(r,2048)),s[o]=16*r,o+=1,f=i,h=r;return s.slice(0,o)}}]),t}();t.default=L},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(r(0));var n=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sampleRate=t,this.channels=r,this.bitsPerSample=i;var n=new ArrayBuffer(44),s=new a.default(n);s.writeUtf8("RIFF"),s.writeUint32(0),s.writeUtf8("WAVE"),s.writeUtf8("fmt "),s.writeUint32(16),s.writeUint16(1),s.writeUint16(this.channels),s.writeUint32(this.sampleRate),s.writeUint32(this.sampleRate*this.bitsPerSample*this.channels/8),s.writeUint16(this.bitsPerSample*this.channels/8),s.writeUint16(this.bitsPerSample),s.writeUtf8("data"),s.writeUint32(0),this.header=s,this.pcmData=null}return i(e,[{key:"writeFrames",value:function(e){var t=this.header;t.seek(4),t.writeUint32(t.byteLength+e.byteLength),t.seek(40),t.writeUint32(e.byteLength),this.pcmData=e}},{key:"getBlob",value:function(){return new Blob([this.header.buffer,this.pcmData.buffer],{type:"audio/wav"})}}]),e}();t.default=n},function(e,t,r){e.exports=r(9)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dataStream=t.wavEncoder=t.bitmapEncoder=t.kwzParser=t.ppmParser=t.parser=t.default=void 0;var i=f(r(10)),a=f(r(3)),n=f(r(4)),s=f(r(6)),o=f(r(1)),u=f(r(7)),h=f(r(0));function f(e){return e&&e.__esModule?e:{default:e}}var l={version:"2.6.2",player:i.default,parser:a.default,ppmParser:n.default,kwzParser:s.default};t.default=l,t.parser=a.default,t.ppmParser=n.default,t.kwzParser=s.default,t.bitmapEncoder=o.default,t.wavEncoder=u.default,t.dataStream=h.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=u(r(2)),n=u(r(3)),s=u(r(13)),o=u(r(17));u(r(2));function u(e){return e&&e.__esModule?e:{default:e}}var h=function(){function e(t,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t="string"==typeof t?document.querySelector(t):t,this.canvas=new a.default(t,r,i),this._imgCanvas=new a.default(document.createElement("canvas"),r,i,{antialias:!0,preserveDrawingBuffer:!0}),this._isOpen=!1,this._events={},this.loop=!1,this.currentFrame=0,this.paused=!0,this.customPalette=null,this.audioTracks=[new o.default("se1"),new o.default("se2"),new o.default("se3"),new o.default("se4"),new o.default("bgm")],this.smoothRendering=!1}return i(e,[{key:"_load",value:function(e){var t=new n.default(e);this.note=t,this.meta=t.meta,this.type=t.type,this.frameCount=t.frameCount,this.frameSpeed=t.frameSpeed,this.fileLength=t.byteLength,this.loop=1==t.meta.loop,this.paused=!0,this._isOpen=!0,this.audioTracks.forEach(function(e){e.sampleRate=t.sampleRate}),this.customPalette&&this.setPalette(this.customPalette),this.note.hasAudioTrack(1)&&this.audioTracks[0].set(this.note.decodeAudio("se1"),1),this.note.hasAudioTrack(2)&&this.audioTracks[1].set(this.note.decodeAudio("se2"),1),this.note.hasAudioTrack(3)&&this.audioTracks[2].set(this.note.decodeAudio("se3"),1),"KWZ"===this.type&&this.note.hasAudioTrack(4)&&this.audioTracks[3].set(this.note.decodeAudio("se4"),1),this.note.hasAudioTrack(0)&&this.audioTracks[4].set(this.note.decodeAudio("bgm"),this._audiorate),this._seFlags=this.note.decodeSoundFlags(),this._playbackLoop=null,this._hasPlaybackStarted=!1,this.layerVisiblity={1:!0,2:!0,3:!0},this.setMode(this.type),this.setFrame(this.note.thumbFrameIndex),this.emit("load")}},{key:"open",value:function(e){var t=this;return this._isOpen&&this.close(),(0,s.default)(e).then(function(e){t._load(e)}).catch(function(e){console.error("Error loading Flipnote:",e)})}},{key:"close",value:function(){this.pause(),this.note=null,this._isOpen=!1,this.paused=!0,this.loop=null,this.meta=null,this.frameCount=null,this.frameSpeed=null,this._frame=0;for(var e=0;e<this.audioTracks.length;e++)this.audioTracks[e].unset();this._seFlags=null,this._hasPlaybackStarted=null,this.canvas.clear(),this._imgCanvas.clear()}},{key:"destroy",value:function(){this.close(),this.canvas.destroy(),this._imgCanvas.destroy()}},{key:"_playFrameSe",value:function(e){for(var t=this._seFlags[e],r=0;r<t.length;r++)t[r]&&this.audioTracks[r].active&&this.audioTracks[r].start()}},{key:"_playBgm",value:function(){this.audioTracks[4].start(this.currentTime)}},{key:"_stopAudio",value:function(){for(var e=0;e<this.audioTracks.length;e++)this.audioTracks[e].stop()}},{key:"play",value:function(){var e=this;if(!this._isOpen||!this.paused)return null;this.paused=!1,this._hasPlaybackStarted&&(this.loop||this.currentFrame!=this.frameCount-1)||(this._frame=0),this._playBgm(),this._playbackLoop=setInterval(function(){e.paused&&clearInterval(e._playbackLoop),e.currentFrame>=e.frameCount-1?(e._stopAudio(),e.loop?(e.firstFrame(),e._playBgm(0),e.emit("playback:loop")):(e.pause(),e.emit("playback:end"))):(e._playFrameSe(e.currentFrame),e.nextFrame())},1e3/this.framerate),this._hasPlaybackStarted=!0,this.emit("playback:start")}},{key:"pause",value:function(){if(!this._isOpen||this.paused)return null;clearInterval(this._playbackLoop),this.paused=!0,this._stopAudio(),this.emit("playback:stop")}},{key:"getFrameImage",value:function(e,t,r,i,a){if(!this._isOpen)return null;var n=this._imgCanvas;return n.width===t&&n.height===r||n.resize(t,r),e="thumb"==e?this.note.thumbFrameIndex:Math.max(0,Math.min(e,this.frameCount-1)),this.drawFrame(e,n),n.toImage(i,a)}},{key:"setPalette",value:function(e){this.customPalette=e,this.note.palette=e,this.forceUpdate()}},{key:"setFrame",value:function(e){if(!this._isOpen||e===this.currentFrame)return null;e=Math.max(0,Math.min(Math.floor(e),this.frameCount-1)),this._frame=e,this._playbackFrameTime=0,this.drawFrame(e,this.canvas),this.emit("frame:update",this.currentFrame)}},{key:"drawFrame",value:function(e,t){var r=this,i=this.note.getFramePalette(e),a=this.note.decodeFrame(e);t.setPaperColor(i[0]),t.clear(),"PPM"==this.note.type?(this.layerVisiblity[2]&&t.drawLayer(a[1],256,192,i[2],[0,0,0,0]),this.layerVisiblity[1]&&t.drawLayer(a[0],256,192,i[1],[0,0,0,0])):"KWZ"==this.note.type&&this.note.getLayerOrder(e).forEach(function(e){r.layerVisiblity[e+1]&&t.drawLayer(a[e],320,240,i[2*e+1],i[2*e+2])})}},{key:"thumbnailFrame",value:function(){this.currentFrame=this.note.thumbFrameIndex}},{key:"nextFrame",value:function(){this.loop&&this.currentFrame>=this.frameCount-1?this.currentFrame=0:this.currentFrame+=1}},{key:"prevFrame",value:function(){this.loop&&this.currentFrame<=0?this.currentFrame=this.frameCount-1:this.currentFrame-=1}},{key:"lastFrame",value:function(){this.currentFrame=this.frameCount-1}},{key:"firstFrame",value:function(){this.currentFrame=0}},{key:"resize",value:function(e,t){this.canvas.resize(e,t),this.forceUpdate()}},{key:"setLayerVisibility",value:function(e,t){this.layerVisiblity[e]=t,this.forceUpdate()}},{key:"setSmoothRendering",value:function(e){var t=e?"linear":"nearest";this.canvas.setFilter(t),this.forceUpdate(),this.smoothRendering=e}},{key:"setMode",value:function(e){this.canvas.setMode(e),this._imgCanvas.setMode(e)}},{key:"forceUpdate",value:function(){this._isOpen&&this.drawFrame(this.currentFrame,this.canvas)}},{key:"on",value:function(e,t){var r=this._events;(r[e]||(r[e]=[])).push(t)}},{key:"off",value:function(e,t){var r=this._events[e];r&&r.splice(r.indexOf(t),1)}},{key:"emit",value:function(e){for(var t=this._events[e]||[],r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];for(var n=0;n<t.length;n++)t[n].apply(null,i)}},{key:"currentFrame",get:function(){return this._frame},set:function(e){this.setFrame(e)}},{key:"currentTime",get:function(){return this._isOpen?this.currentFrame*(1/this.framerate):null},set:function(e){this._isOpen&&e<this.duration&&e>0&&this.setFrame(Math.round(e/(1/this.framerate)))}},{key:"volume",get:function(){return this.audioTracks[3].audio.volume},set:function(e){for(var t=0;t<this.audioTracks.length;t++)this.audioTracks[t].audio.volume=e}},{key:"muted",get:function(){return this.audioTracks[3].audio.muted},set:function(e){for(var t=0;t<this.audioTracks.length;t++)this.audioTracks[t].audio.muted=e}},{key:"duration",get:function(){return this._isOpen?this.frameCount*(1/this.framerate):null}},{key:"framerate",get:function(){return this.note.framerate}},{key:"_audiorate",get:function(){return 1/this.note.bgmrate/(1/this.note.framerate)}}]),e}();t.default=h},function(e,t){e.exports="#define GLSLIFY 1\nattribute vec4 a_position;\nvarying vec2 v_texcoord;\nvoid main() {\n  gl_Position = a_position;\n  v_texcoord = a_position.xy * vec2(0.5, -0.5) + 0.5;\n}"},function(e,t){e.exports="precision mediump float;\n#define GLSLIFY 1\nvarying vec2 v_texcoord;\nuniform vec4 u_color1;\nuniform vec4 u_color2;\nuniform sampler2D u_bitmap;\nuniform bool u_isSmooth;\nvoid main() {\n  float weightColor1 = texture2D(u_bitmap, v_texcoord).a;\n  float weightColor2 = texture2D(u_bitmap, v_texcoord).r;\n  float alpha = 1.0;\n  if (u_isSmooth) {\n    weightColor1 = smoothstep(0.0, .9, weightColor1);\n    weightColor2 = smoothstep(0.0, .9, weightColor2);\n    float alpha = weightColor1 + weightColor2;\n  }\n  gl_FragColor = vec4(u_color1.rgb, alpha) * weightColor1 + vec4(u_color2.rgb, alpha) * weightColor2;\n}\n"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return new Promise(function(t,r){for(var i=0;i<o.length;i++){var a=o[i];if(a.matches(e)){a.load(e,t,r);break}}})};var i=s(r(14)),a=s(r(15)),n=s(r(16));function s(e){return e&&e.__esModule?e:{default:e}}var o=[i.default,a.default,n.default]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={matches:function(e){return"string"==typeof e},load:function(e,t,r){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onreadystatechange=function(e){4===i.readyState&&(i.status>=200&&i.status<300?t(i.response):r({type:"httpError",status:i.status,statusText:i.statusText}))},i.send(null)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={matches:function(e){return e instanceof File},load:function(e,t,r){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.onerror=function(e){r({type:"fileReadError"})},i.readAsArrayBuffer(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={matches:function(e){return e instanceof ArrayBuffer},load:function(e,t,r){t(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(r(7));var n=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.channelCount=1,this.bitsPerSample=16,this.sampleRate=0,this.playbackRate=1,this.audio=document.createElement("audio"),this.audio.preload=!0,this.active=!1}return i(e,[{key:"set",value:function(e,t){var r=new a.default(this.sampleRate*t,this.channelCount,this.bitsPerSample);r.writeFrames(e),this.url=window.URL.createObjectURL(r.getBlob()),this.audio.src=this.url,this.active=!0,this.playbackRate=t,this.length=e.length}},{key:"unset",value:function(){this.active&&(window.URL.revokeObjectURL(this.url),this.audio.src="",this.audio.load(),this.active=!1,this.playbackRate=1,this.length=null)}},{key:"start",value:function(e){this.active&&(this.audio.currentTime=e||0,this.audio.play())}},{key:"stop",value:function(){this.active&&this.audio.pause()}},{key:"duration",get:function(){return this.audio.duration}}]),e}();t.default=n}]).default});
//# sourceMappingURL=flipnote.min.js.map